(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"7b91":function(t,e,a){"use strict";a("93e9")},8622:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{attrs:{view:"hHr lpR fFr"}},[a("q-header",{staticClass:"bg-pink-11 text-white",attrs:{bordered:""}},[a("q-toolbar",[a("q-toolbar-title",[t._v("\n        ゆゆゆい烤肉助手\n      ")]),a("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"menu"},on:{click:function(e){t.right=!t.right}}})],1)],1),a("q-drawer",{attrs:{"show-if-above":"",side:"right",bordered:""},model:{value:t.right,callback:function(e){t.right=e},expression:"right"}},[a("q-list",{attrs:{bordered:""}},[a("q-expansion-item",{attrs:{"expand-separator":"",icon:"description",label:"文本"}},[a("div",{staticClass:"row q-py-sm q-px-md"},[a("q-space"),a("q-btn",{attrs:{padding:"none",color:"pink",icon:"add",flat:""},on:{click:function(e){return t.$refs.file.click()}}}),a("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.add}})],1),t._l(t.text_list,(function(e,s){return a("q-card",{key:s,staticClass:"q-ma-xs",attrs:{bordered:""}},[a("q-card-section",{staticClass:"row"},[t._v("\n            "+t._s(e.title)+"\n            "),a("q-space"),a("q-radio",{attrs:{val:s,dense:""},model:{value:t.text_select,callback:function(e){t.text_select=e},expression:"text_select"}})],1)],1)})),a("div",{staticClass:"flex flex-center"},[a("q-pagination",{attrs:{max:Math.ceil(this.text_count/t.limit),input:""},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}})],1),a("q-inner-loading",{attrs:{showing:0==t.text_list.length&&!t.loaded}},[a("q-spinner-bars",{attrs:{size:"50px",color:"pink"}})],1)],2),a("q-expansion-item",{attrs:{"expand-separator":"",icon:"book",label:"词典"}},[t._l(t.dicts,(function(e,s){return a("q-card",{key:s,staticClass:"q-ma-xs",attrs:{bordered:""}},[a("q-card-section",{staticClass:"row"},[t._v("\n            "+t._s(e.name)+"\n            "),a("q-space")],1)],1)})),a("q-inner-loading",{attrs:{showing:0==t.dicts.length&&!t.loaded}},[a("q-spinner-bars",{attrs:{size:"50px",color:"pink"}})],1)],2)],1)],1),a("q-page-container",[a("q-page",{staticClass:"flex flex-center row",attrs:{padding:""}},[a("div",{staticClass:"col-xs-12 col-sm-8 col-md-6 col-xl-4"},t._l(t.data.text,(function(e,s){return a("div",{key:s,staticClass:"q-pb-sm"},["text"==e.type?a("q-card",{attrs:{flat:"",bordered:""}},[a("div",{staticClass:"row q-px-md q-py-xs bg-pink-1"},[a("div",[t._v("\n                "+t._s(e.speaker)+"\n                "),a("q-btn",{attrs:{color:"primary",icon:"update",size:"xs",flat:"",round:""},on:{click:function(a){e.roasted_speaker=t.speaker_replace(e.speaker)}}}),a("div",{class:"cursor-pointer text-caption"+(e.roasted_speaker?" text-grey":" text-negative text-bold")},[t._v("\n                  "+t._s(e.roasted_speaker?e.roasted_speaker:"人名（中文）")+"\n                  "),a("q-popup-edit",{attrs:{"auto-save":""},model:{value:e.roasted_speaker,callback:function(a){t.$set(e,"roasted_speaker",a)},expression:"item.roasted_speaker"}},[a("q-input",{attrs:{dense:"",autofocus:""},model:{value:e.roasted_speaker,callback:function(a){t.$set(e,"roasted_speaker",a)},expression:"item.roasted_speaker"}})],1)],1)],1),a("q-space"),t._v("\n              "+t._s(e.speaker_skin)+"\n            ")],1),a("q-card-section",{staticClass:"q-pt-xs"},[a("q-field",{attrs:{color:"orange",placeholder:"原文",readonly:"",autogrow:""},scopedSlots:t._u([{key:"control",fn:function(){return[a("div",{staticStyle:{"white-space":"pre-line"},domProps:{innerHTML:t._s(e.text)}})]},proxy:!0}],null,!0)}),a("q-input",{attrs:{type:"textarea",color:"pink",placeholder:"译文",autogrow:""},model:{value:e.roasted_text,callback:function(a){t.$set(e,"roasted_text",a)},expression:"item.roasted_text"}}),a("q-input",{attrs:{type:"text",color:"pink",placeholder:"备注",dense:"",autogrow:""},model:{value:e.comment,callback:function(a){t.$set(e,"comment",a)},expression:"item.comment"}})],1)],1):"location"==e.type?a("q-card",{staticClass:"bg-pink-1 text-h6 q-pa-sm",staticStyle:{"text-align":"center"},attrs:{flat:"",bordered:"",dense:""},domProps:{textContent:t._s(e.name)}}):a("q-chip",["bgm"==e.type?a("q-avatar",{attrs:{icon:"music_note",color:"red","text-color":"white"}}):"se"==e.type?a("q-avatar",{attrs:{icon:"volume_up",color:"red","text-color":"white"}}):t._e(),t._v("\n            "+t._s(e.name)+"\n          ")],1)],1)})),0),a("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[a("q-btn",{staticClass:"bg_transition",attrs:{label:t.diff_num+":保存",size:"lg",color:0==t.diff_num?"positive":"negative",rounded:""},on:{click:function(e){return t.update()}}})],1),a("q-inner-loading",{attrs:{showing:0==t.data.text.length&&!t.loaded}},[a("q-spinner-bars",{attrs:{size:"50px",color:"pink"}})],1)],1)],1)],1)},i=[],r=a("ded3"),o=a.n(r),n=(a("e6cf"),a("5319"),a("ddb0"),{name:"YuyuyuiTranslationHelper",data(){return{last_updated:null,loaded:!1,text_list:[],text_select:0,text_count:0,dicts:[],data:{text:[]},diff_num:0,update_flag:!1,right:!1,limit:20,page:1}},watch:{async page(t){let e=await this.get("/cookieartbot/yyyi/records",{limit:this.limit,skip:(this.page-1)*this.limit,projection:JSON.stringify({text:0})});this.text_list=e.data.data},async text_select(t){this.data=this.text_list[t]},data:{deep:!0,handler(t,e){this.update_flag||0==e.text.length||(this.update_flag=!0,setTimeout((async()=>{let t=await this.get("/cookieartbot/yyyi/records",{query:JSON.stringify({_id:this.data._id})}),e=t.data.data[0];e.last_modified>this.last_updated&&null!=this.last_updated&&location.reload();let a=0;for(const s in this.data)if("text"!=s)this.data[s]!=e[s]&&a++;else for(const t in this.data[s])for(const i in this.data[s][t])if(this.data[s][t][i]!=e[s][t][i]){a++;break}this.diff_num=a,this.update_flag=!1}),2500))}},diff_num(t){t>0&&this.update()}},methods:{add(t){let e=t.target.files[0],a=new FileReader;a.onload=async()=>{let t=this.yuyuyui_script_serialize(a.result);await this.post("/cookieartbot/yyyi/add",{title:e.name,text:t}),await this.reset()},a.readAsText(e)},get(t,e={}){return this.$axios({method:"get",url:t,responseType:"json",params:e})},post(t,e){return this.$axios({method:"post",url:t,responseType:"json",data:e})},yuyuyui_script_serialize(t){function e(t,e,a,s,i){return`<span style="font-size: ${Math.round(e/48*100)/100}em;">${a}</span>`}t=t.split("\r\n");let a=[],s=1;for(let i=0;i<t.length;i++){let r=t[i];if(/^.*    <.*>$/.test(r)){i++;let o=r.match(/^(.*)    <(.*)>$/),n={_id:s,type:"text",speaker:o[1],speaker_skin:o[2],roasted_speaker:"",text:"",roasted_text:"",comment:""},l=[];for(;t[i];i++)l.push(t[i].slice(4));n.text=l.join("\n"),n.text=n.text.replace(/@s\((\d+)\)\{(.+)\}/g,e),n.text=n.text.replace(/@c\((.+)\)\{(.+)\}/g,'<span style="color: $1;">$2</span>'),n.text=n.text.replace(/@b\{(.+)\}/g,"<b>$1</b>"),a.push(n),s++}else if(/^BGM: .*$/.test(r)){let t=r.match(/^BGM: (.*$)/),e={_id:s,type:"bgm",name:t[1]};a.push(e),s++}else if(/^SE: .*$/.test(r)){let t=r.match(/^SE: (.*$)/),e={_id:s,type:"se",name:t[1]};a.push(e),s++}else{if(!/^■■■.*■■■$/.test(r))continue;{let t=r.match(/^■■■(.*)■■■$/),e={_id:s,type:"location",name:t[1]};a.push(e),s++}}}return a},async reset(){let t=[this.get("/cookieartbot/yyyi/records",{limit:this.limit,skip:(this.page-1)*this.limit}),this.get("/cookieartbot/yyyi/records_count"),this.get("/cookieartbot/yyyi/dicts")],e=await Promise.all(t);this.text_list=e[0].data.data,this.data=this.text_select in this.text_list?this.text_list[this.text_select]:{text:[]},this.text_count=e[1].data.count,this.dicts=e[2].data.data,this.loaded=!0},speaker_replace(t){return this.all_entries[t]?this.all_entries[t]:""},async update(){let t=await this.post("/cookieartbot/yyyi/update",{query:{_id:this.data._id},data:this.data});200==t.status?(this.diff_num=0,this.last_updated=this.data.last_modified=this.now_timestamp()):this.$q.notify({message:"保存失败，请检查",color:"negative",position:"top"})},now_timestamp(){return Math.round(Date.now()/1e3)}},computed:{all_entries(){let t={};for(let e of this.dicts)t=o()(o()({},t),e.entries);return t}},async created(){await this.reset()}}),l=n,d=(a("7b91"),a("2877")),c=a("4d5a"),p=a("e359"),u=a("65c6"),h=a("6ac5"),_=a("9c40"),x=a("9404"),f=a("1c1c"),m=a("3b73"),y=a("2c91"),g=a("f09f"),b=a("a370"),k=a("3786"),q=a("3b16"),w=a("74f7"),v=a("a154"),Q=a("09e3"),$=a("9989"),C=a("42a1"),S=a("27f9"),T=a("8572"),z=a("b047"),P=a("cb32"),M=a("de5e"),j=a("eebe"),E=a.n(j),B=Object(d["a"])(l,s,i,!1,null,null,null);e["default"]=B.exports;E()(B,"components",{QLayout:c["a"],QHeader:p["a"],QToolbar:u["a"],QToolbarTitle:h["a"],QBtn:_["a"],QDrawer:x["a"],QList:f["a"],QExpansionItem:m["a"],QSpace:y["a"],QCard:g["a"],QCardSection:b["a"],QRadio:k["a"],QPagination:q["a"],QInnerLoading:w["a"],QSpinnerBars:v["a"],QPageContainer:Q["a"],QPage:$["a"],QPopupEdit:C["a"],QInput:S["a"],QField:T["a"],QChip:z["a"],QAvatar:P["a"],QPageSticky:M["a"]})},"93e9":function(t,e,a){}}]);