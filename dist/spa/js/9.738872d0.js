(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"21c2":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flex flex-center row"},[a("div",{staticClass:"col-8"},[a("q-card",{staticClass:"q-pa-sm q-my-md bg-grey-2 row",staticStyle:{width:"100%"},attrs:{flat:""}},[a("q-file",{staticClass:"col-5",attrs:{outlined:"",label:"配置文件",accept:".json"},scopedSlots:t._u([{key:"after",fn:function(){return[t.file?a("q-btn",{staticClass:"q-mr-sm",attrs:{disable:t.btndisabled,outline:""},on:{click:t.packages}},[t._v("\n            "+t._s(t.btntext)+"\n          ")]):t._e(),t.file?a("q-btn",{staticClass:"q-mr-sm",attrs:{disable:null==t.dlfile,outline:""},on:{click:t.filedl}},[t._v("\n            保存\n          ")]):t._e(),t.file?a("q-btn",{attrs:{outline:""},on:{click:t.saveConf}},[t._v("\n            保存配置文件\n          ")]):t._e()]},proxy:!0}]),model:{value:t.file,callback:function(e){t.file=e},expression:"file"}})],1),t._l(t.data,(function(e,i){return a("div",{key:i},["orig_10_6"==i||"orig_5_1"==i||"repo_5_1"==i||"pickup"==i?a("Configs",{attrs:{data:e,subs:i}}):t._e()],1)}))],2)])},n=[],s=(a("e6cf"),a("5319"),a("c4e3")),l=a.n(s),o=a("21a6"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-dialog",{ref:"dialog",attrs:{"no-backdrop-dismiss":""},on:{hide:t.onDialogHide}},[a("q-card",{staticClass:"q-dialog-plugin column",staticStyle:{"max-width":"100%",width:"1000px","max-height":"100%",height:"750px"}},[a("div",{staticClass:"col-1 q-px-sm row"},[a("q-file",{staticClass:"col-10 q-my-sm",attrs:{outlined:"",dense:"",label:"视频文件",accept:".flv, .mp4"},model:{value:t.vfile,callback:function(e){t.vfile=e},expression:"vfile"}}),a("div",{staticClass:"col-2 flex flex-center"},[a("q-btn",{attrs:{color:"primary"},on:{click:function(e){return t.open("https://www.bilibili.com/video/av"+t.data.aid)}}},[t._v(t._s("av"+t.data.aid))])],1)],1),a("div",{staticClass:"col-xs-7 col-sm-8"},[a("vue-flv-player",{ref:"player",staticStyle:{width:"100%",height:"100%"},attrs:{controls:!0,source:t.vsrc,type:t.vtype}})],1),a("div",{staticClass:"col-1 flex justify-start q-px-md"},[a("q-range",{attrs:{min:0,max:t.vduration,step:.1,"left-label-value":"入点 "+t.timeFormat(t.inout.min),"right-label-value":"出点 "+t.timeFormat(t.inout.max),label:""},model:{value:t.inout,callback:function(e){t.inout=e},expression:"inout"}}),a("q-badge",{staticClass:"q-mr-sm",attrs:{color:"secondary"}},[t._v("\n        片段长度: "+t._s((this.inout.max-this.inout.min).toFixed(1))+"''\n      ")]),null==t.vfile?a("q-badge",{attrs:{color:"negative"}},[t._v("\n        请选择视频文件\n      ")]):t._e()],1),a("div",{staticClass:"col-xs-2 col-sm-1 q-px-sm row"},[a("q-input",{staticClass:"col-xs-11 col-sm-3 q-mr-sm",staticStyle:{"margin-top":"12px"},attrs:{outlined:"",label:"入点（秒）",type:"number"},scopedSlots:t._u([{key:"after",fn:function(){return[a("q-btn",{attrs:{round:"",flat:"",icon:"double_arrow"},on:{click:function(e){return t.seek(t.inout.min)}}},[a("q-tooltip",[t._v("\n              跳转到入点\n            ")])],1),a("q-btn",{attrs:{round:"",flat:"",icon:"sell"},on:{click:t.setInpoint}},[a("q-tooltip",[t._v("\n              设置当前位置为入点\n            ")])],1)]},proxy:!0}]),model:{value:t.inout.min,callback:function(e){t.$set(t.inout,"min",t._n(e))},expression:"inout.min"}}),a("q-input",{staticClass:"col-xs-11 col-sm-3",staticStyle:{"margin-top":"12px"},attrs:{outlined:"",label:"出点（秒）",type:"number"},scopedSlots:t._u([{key:"after",fn:function(){return[a("q-btn",{attrs:{round:"",flat:"",icon:"double_arrow"},on:{click:function(e){return t.seek(t.inout.max)}}},[a("q-tooltip",[t._v("\n              跳转到出点\n            ")])],1),a("q-btn",{attrs:{round:"",flat:"",icon:"sell"},on:{click:t.setOutpoint}},[a("q-tooltip",[t._v("\n              设置当前位置为出点\n            ")])],1)]},proxy:!0}]),model:{value:t.inout.max,callback:function(e){t.$set(t.inout,"max",t._n(e))},expression:"inout.max"}}),"搬运"==t.data.type?a("q-input",{staticClass:"col-xs-11 col-sm-3",staticStyle:{"margin-top":"12px"},attrs:{outlined:"",label:"原作者"},model:{value:t.owner_orig,callback:function(e){t.owner_orig=e},expression:"owner_orig"}}):t._e()],1),a("q-card-actions",{staticClass:"col-1",attrs:{align:"right"}},[a("q-separator"),a("q-btn",{attrs:{flat:"",color:"primary",label:"确定"},on:{click:t.onOKClick}}),a("q-btn",{attrs:{flat:"",color:"primary",label:"返回"},on:{click:t.onCancelClick}})],1)],1)],1)},c=[],d={props:{data:{type:Object,required:!0}},data(){return{inout:{min:0,max:0},vduration:10,vfile:null,vsrc:"",vtype:"mp4",owner_orig:null,setinterval:null,flag:!1}},watch:{vfile(t){let e=new FileReader;e.readAsDataURL(t),e.onload=()=>{this.vsrc=e.result,this.vtype=t.name.slice(-3),console.log(this.$refs.player)}}},mounted(){"file"in this.data&&(this.vfile=this.data.file),this.setinterval=setInterval((()=>{this.$refs.player.flvPlayer&&(this.vduration=this.$refs.player.flvPlayer.duration,0==this.flag&&("start_time"in this.data&&(this.inout.min=this.data.start_time,this.inout.max=this.data.start_time+this.data.duration),this.flag=!0))}),1e3)},destroyed(){clearInterval(this.setinterval)},methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOKClick(){let t=null==this.vfile,e=0==this.inout.min&&0==this.inout.max,a=!1,i=[];if("搬运"==this.data.type&&(a=null==this.owner_orig),t||e||a)t&&i.push("未选择视频文件！"),e&&i.push("未填写入点出点！"),a&&i.push("未填写原作者名！"),this.$q.notify({message:i.join("; "),color:"negative",multiLine:!0,position:"bottom"});else{let t=Object.assign({},this.data);t.start_time=this.inout.min,t.duration=this.inout.max-this.inout.min,this.owner_orig&&(t.owner_orig=this.owner_orig),this.vfile?(t.file=this.vfile,t.source_file=`./${this.vfile.name}`):t.source_file=null,this.$emit("ok",{data:t}),this.hide()}},onCancelClick(){this.hide()},seek(t){this.$refs.player.flvPlayer.currentTime=t},setInpoint(){this.$refs.player.flvPlayer.currentTime<this.inout.max?this.inout.min=Number(this.$refs.player.flvPlayer.currentTime.toFixed(1)):(this.inout.min=Number(this.$refs.player.flvPlayer.currentTime.toFixed(1)),this.inout.max=Number(this.$refs.player.flvPlayer.currentTime.toFixed(1)))},setOutpoint(){this.$refs.player.flvPlayer.currentTime>this.inout.min&&(this.inout.max=Number(this.$refs.player.flvPlayer.currentTime.toFixed(1)))},timeFormat(t){let e=String(Math.floor(t/60)),a=String(Math.floor(t%60));return e.length<2&&(e="0"+e),a.length<2&&(a="0"+a),e+":"+a},open(t){window.open(t,"_blank")}}},u=d,p=a("2877"),f=a("24e8"),m=a("f09f"),h=a("7d53"),b=a("9c40"),v=a("7bbf"),_=a("58a81"),y=a("27f9"),g=a("05c0"),x=a("4b7e"),k=a("eb85"),q=a("eebe"),w=a.n(q),C=Object(p["a"])(u,r,c,!1,null,null,null),$=C.exports;w()(C,"components",{QDialog:f["a"],QCard:m["a"],QFile:h["a"],QBtn:b["a"],QRange:v["a"],QBadge:_["a"],QInput:y["a"],QTooltip:g["a"],QCardActions:x["a"],QSeparator:k["a"]});var O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"q-pa-sm q-my-md bg-grey-2",staticStyle:{width:"100%"},attrs:{flat:""}},[a("q-card-section",[a("div",{staticClass:"q-mb-md text-h6 text-primary"},["pickup"!=t.subs?a("span",[t._v(" "+t._s(t.data[0].type)+"榜 ")]):a("span",[t._v(" Pick up ")]),t.data.length>0&&"rank"in t.data[0]?a("span",[t._v("\n        "+t._s(t.data[0].rank)+"-"+t._s(t.data.slice(-1)[0].rank)+"\n      ")]):t._e()]),t._l(t.data,(function(e,i){return a("q-banner",{key:i,staticClass:"q-my-sm bg-primary text-white",attrs:{rounded:""},scopedSlots:t._u([{key:"action",fn:function(){return[a("q-btn",{attrs:{flat:"",round:"",color:"white",icon:"edit"},on:{click:function(a){return t.$parent.dialog(e)}}})]},proxy:!0}],null,!0)},[e.rank?a("span",{staticClass:"text-h6",domProps:{textContent:t._s(e.rank+" ")}}):t._e(),a("span",{staticClass:"text-subtitle1",domProps:{textContent:t._s(e.title)}}),a("Check",{staticClass:"q-ml-md",attrs:{data:e}})],1)}))],2)],1)},S=[],Q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",["file"in t.data?t._e():a("span",[t._v("🈚未选择源文件！")]),"start_time"in t.data?t._e():a("span",[t._v("🈚未选择片段！")]),"搬运"!=t.data.type||"owner_orig"in t.data?t._e():a("span",[t._v("🈚未填写原作者名！")])])},j=[],F={name:"check",props:{data:{type:Object,required:!0}}},P=F,T=Object(p["a"])(P,Q,j,!1,null,null,null),A=T.exports,N={components:{Check:A},name:"configs",props:{data:{type:[Object,Array],required:!0},subs:{type:String,default:"orig_10_6"}}},R=N,B=a("a370"),D=a("54e1"),I=Object(p["a"])(R,O,S,!1,null,null,null),J=I.exports;w()(I,"components",{QCard:m["a"],QCardSection:B["a"],QBanner:D["a"],QBtn:b["a"]});var E={name:"RankingConfigMaker",components:{Configs:J},data(){return{data:{},file:null,dlfile:null,btntext:"打包",btndisabled:!1}},methods:{dialog(t){this.$q.dialog({component:$,parent:this,data:t}).onOk(((t,e)=>{console.log("OK",t);for(let a in this.data){this.data[a].push({}),this.data[a].pop();for(let e in this.data[a])if(this.data[a][e].aid==t.data.aid){this.data[a][e]=t.data;break}}})).onCancel((()=>{})).onDismiss((()=>{}))},async packages(){this.btndisabled=!0;let t=new l.a;t.file("data.json",JSON.stringify(this.data));for(let e in this.data)for(let a in this.data[e])if("file"in this.data[e][a]){let i=this.data[e][a].file,n=t=>new Promise(((e,a)=>{let i=new FileReader;i.readAsDataURL(t),i.onload=()=>{e(i.result)}}));t.file(i.name,(await n(i)).split(",")[1],{base64:!0})}this.dlfile=await t.generateAsync({type:"blob"},(t=>{this.btntext=t.percent.toFixed(2)+"%"})),this.btndisabled=!1,this.btntext="OK"},filedl(){Object(o["saveAs"])(this.dlfile,this.file.name.replace(".json",".zip"))},saveConf(){let t=new Blob([JSON.stringify(this.data)],{type:"application/json;charset=utf-8"});Object(o["saveAs"])(t,this.file.name)}},watch:{file(t){let e=new FileReader;e.readAsText(t),e.onload=t=>{let e=JSON.parse(t.target.result);for(let a in e)"orig_10_6"==a||"orig_5_1"==a||"repo_5_1"==a||"pickup"==a||delete e[a];this.data=e,console.log(this.data)}}}},K=E,L=Object(p["a"])(K,i,n,!1,null,null,null);e["default"]=L.exports;w()(L,"components",{QCard:m["a"],QFile:h["a"],QBtn:b["a"]})}}]);