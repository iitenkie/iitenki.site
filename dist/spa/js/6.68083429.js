(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{8622:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{attrs:{view:"hHh lpR fFr"}},[a("q-header",{staticClass:"bg-pink-11 text-white",attrs:{bordered:""}},[a("q-toolbar",[a("q-toolbar-title",[t._v("\n        云烤肉\n      ")]),a("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"menu"},on:{click:function(e){t.right=!t.right}}})],1),a("q-bar",{staticClass:"bg-pink-1 text-black"},[a("div",{staticClass:"cursor-pointer"},[t._v("\n        "+t._s(t.data.title)+"\n        "),a("q-popup-edit",{attrs:{"auto-save":""},model:{value:t.data.title,callback:function(e){t.$set(t.data,"title",e)},expression:"data.title"}},[a("q-input",{attrs:{debounce:"1000",dense:"",autofocus:""},model:{value:t.data.title,callback:function(e){t.$set(t.data,"title",e)},expression:"data.title"}})],1)],1),a("div",{staticClass:"ellipsis cursor-pointer text-italic",staticStyle:{"font-size":"0.85rem"}},[t._v("\n        "+t._s(t.data.comment?t.data.comment:"备注")+"\n        "),a("q-popup-edit",{attrs:{"auto-save":""},model:{value:t.data.comment,callback:function(e){t.$set(t.data,"comment",e)},expression:"data.comment"}},[a("q-input",{attrs:{debounce:"1000",dense:"",autofocus:""},model:{value:t.data.comment,callback:function(e){t.$set(t.data,"comment",e)},expression:"data.comment"}})],1)],1)])],1),a("q-drawer",{attrs:{"show-if-above":"",side:"right",bordered:""},model:{value:t.right,callback:function(e){t.right=e},expression:"right"}},[a("q-list",{staticClass:"rounded-borders text-pink-6",attrs:{padding:""}},[a("div",{staticClass:"row q-pa-sm q-ma-xs rounded-borders"},[t._v("\n        文本\n        "),a("q-space"),a("q-btn",{staticClass:"q-mx-sm",attrs:{padding:"none",color:"pink-11",icon:"add",flat:""},on:{click:function(e){return t.text_add_click()}}}),a("q-btn",{staticClass:"q-mx-sm",attrs:{padding:"none",color:"pink-11",icon:"ios_share",flat:""},on:{click:function(e){return t.save_conf()}}}),a("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file",accept:"text/*"},on:{change:t.add}})],1),t._l(t.text_list,(function(e,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,staticClass:"q-ma-xs rounded-borders",attrs:{clickable:"",active:t.text_select===s,"active-class":"menu_active"},on:{click:function(e){t.text_select=s}}},[a("q-item-section",[t._v("\n          "+t._s(e.title)+"\n        ")])],1)})),a("div",{staticClass:"flex flex-center"},[a("q-pagination",{attrs:{max:Math.ceil(this.text_count/t.limit),input:"",color:"pink-11"},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}})],1),a("q-inner-loading",{attrs:{showing:0==t.text_list.length&&!t.loaded}},[a("q-spinner-bars",{attrs:{size:"50px",color:"pink"}})],1),a("q-separator"),a("q-expansion-item",{attrs:{"expand-separator":"",label:"词典"}},[t._l(t.dicts,(function(e,s){return a("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:s,staticClass:"q-ma-xs",attrs:{clickable:""}},[a("q-item-section",{staticClass:"row"},[t._v("\n            "+t._s(e.name)+"\n          ")])],1)})),a("q-inner-loading",{attrs:{showing:0==t.dicts.length&&!t.loaded}},[a("q-spinner-bars",{attrs:{size:"50px",color:"pink"}})],1)],2)],2)],1),a("q-page-container",[a("q-page",{staticClass:"flex flex-center row",attrs:{padding:""}},[a("div",{staticClass:"col-xs-12 col-sm-8 col-md-6 col-xl-4"},t._l(t.data.text,(function(e,s){return a("div",{key:s,staticClass:"q-pb-sm"},["text"==e.type?a("q-card",{attrs:{flat:"",bordered:""}},[a("div",{staticClass:"row q-px-md q-py-xs bg-pink-1"},[a("div",[a("span",{staticClass:"speaker-font"},[t._v(t._s(e.speaker))]),a("q-btn",{attrs:{color:"primary",icon:"update",size:"xs",flat:"",round:""},on:{click:function(a){e.roasted_speaker=t.speaker_replace(e.speaker)}}}),a("div",{class:"cursor-pointer text-caption roasted-speaker-font"+(e.roasted_speaker?" text-grey-8":" text-negative text-bold")},[t._v("\n                  "+t._s(e.roasted_speaker?e.roasted_speaker:"角色名（中文）")+"\n                  "),a("q-popup-edit",{attrs:{"auto-save":""},model:{value:e.roasted_speaker,callback:function(a){t.$set(e,"roasted_speaker",a)},expression:"item.roasted_speaker"}},[a("q-input",{attrs:{debounce:"1000",dense:"",autofocus:""},model:{value:e.roasted_speaker,callback:function(a){t.$set(e,"roasted_speaker",a)},expression:"item.roasted_speaker"}})],1)],1)],1),a("q-space"),t._v("\n              "+t._s(e.speaker_skin)+"\n            ")],1),a("q-card-section",{staticClass:"q-pt-xs"},[a("q-field",{attrs:{color:"orange",placeholder:"原文",readonly:"",autogrow:""},scopedSlots:t._u([{key:"control",fn:function(){return[a("div",{staticClass:"text original-font",staticStyle:{"white-space":"pre-line"},domProps:{innerHTML:t._s(e.text)}})]},proxy:!0}],null,!0)}),a("q-input",{staticClass:"text roasted-font",attrs:{debounce:"500",type:"textarea",color:"pink",placeholder:"译文",autogrow:""},model:{value:e.roasted_text,callback:function(a){t.$set(e,"roasted_text",a)},expression:"item.roasted_text"}}),a("q-input",{attrs:{debounce:"500",type:"text",color:"pink",placeholder:"备注",dense:"",autogrow:""},model:{value:e.comment,callback:function(a){t.$set(e,"comment",a)},expression:"item.comment"}})],1)],1):"location"==e.type?a("q-card",{staticClass:"bg-pink-1 text-h6 q-pa-sm",staticStyle:{"text-align":"center"},attrs:{flat:"",bordered:"",dense:""},domProps:{textContent:t._s(e.name)}}):a("q-chip",["bgm"==e.type?a("q-avatar",{attrs:{icon:"music_note",color:"red","text-color":"white"}}):"se"==e.type?a("q-avatar",{attrs:{icon:"volume_up",color:"red","text-color":"white"}}):t._e(),t._v("\n            "+t._s(e.name)+"\n          ")],1)],1)})),0),a("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[a("q-btn",{staticClass:"bg_transition",attrs:{label:t.diff_num+":保存",size:"lg",color:0==t.diff_num?"positive":"negative",rounded:""},on:{click:function(e){return t.update()}}})],1),a("q-inner-loading",{attrs:{showing:0==t.data.text.length&&!t.loaded}},[a("q-spinner-bars",{attrs:{size:"50px",color:"pink"}})],1)],1)],1)],1)},i=[],o=a("ded3"),n=a.n(o),r=(a("e6cf"),a("5319"),a("ddb0"),a("21a6")),l={name:"YuyuyuiTranslationHelper",data(){return{last_updated:void 0,loaded:!1,text_list:[],text_select:0,text_count:0,dicts:[],data:{text:[]},diff_num:0,update_flag:!1,right:!1,limit:20,page:1}},watch:{async page(t){let e=await this.get("/cookieartbot/yyyi/record",{params:{limit:this.limit,skip:(this.page-1)*this.limit,projection:JSON.stringify({text:0})}});this.text_list=e.data.data},async text_select(t){this.data=this.text_list[t],window.scrollTo(0,0)},data:{deep:!0,handler(t,e){t._id==e._id&&(this.update_flag||0==e.text.length||(this.update_flag=!0,setTimeout((async()=>{let t=await this.get(`/cookieartbot/yyyi/record/${this.data._id}`),e=t.data.data;if(void 0!=this.data.last_modified&&e.last_modified>this.data.last_modified)location.reload();else{let t=0;for(const a in this.data)if("last_modified"!=a)if("text"!=a)this.data[a]!=e[a]&&t++;else for(const s in this.data[a])for(const i in this.data[a][s])if(this.data[a][s][i]!=e[a][s][i]){t++;break}this.diff_num=t}this.update_flag=!1}),2500)))}},diff_num(t){t>0&&this.update()}},methods:{add(t){let e=t.target.files[0],a=new FileReader;a.onload=async()=>{let t=this.yuyuyui_script_serialize(a.result);await this.post("/cookieartbot/yyyi/record",{data:{title:e.name,text:t}}),await this.reset()},a.readAsText(e)},get(t,e={}){return this.$axios(n()({method:"get",url:t,responseType:"json"},e))},post(t,e={}){return this.$axios(n()({method:"post",url:t,responseType:"json"},e))},put(t,e={}){return this.$axios(n()({method:"put",url:t,responseType:"json"},e))},delete(t,e={}){return this.$axios(n()({method:"delete",url:t,responseType:"json"},e))},yuyuyui_script_serialize(t){function e(t,e,a,s,i){return`<span style="font-size: ${Math.round(e/48*100)/100}em;">${a}</span>`}t=t.split("\r\n");let a=[],s=1;for(let i=0;i<t.length;i++){let o=t[i];if(/^.*    <.*>$/.test(o)){i++;let n=o.match(/^(.*)    <(.*)>$/),r={_id:s,type:"text",speaker:n[1],speaker_skin:n[2],roasted_speaker:"",text:"",roasted_text:"",comment:""},l=[];for(;t[i];i++)l.push(t[i].slice(4));r.text=l.join("\n"),r.text=r.text.replace(/@s\((\d+)\)\{(.+)\}/g,e),r.text=r.text.replace(/@c\((.+)\)\{(.+)\}/g,'<span style="color: $1;">$2</span>'),r.text=r.text.replace(/@b\{(.+)\}/g,"<b>$1</b>"),a.push(r),s++}else if(/^BGM: .*$/.test(o)){let t=o.match(/^BGM: (.*$)/),e={_id:s,type:"bgm",name:t[1]};a.push(e),s++}else if(/^SE: .*$/.test(o)){let t=o.match(/^SE: (.*$)/),e={_id:s,type:"se",name:t[1]};a.push(e),s++}else{if(!/^■■■.*■■■$/.test(o))continue;{let t=o.match(/^■■■(.*)■■■$/),e={_id:s,type:"location",name:t[1]};a.push(e),s++}}}return a},async reset(){let t=[this.get("/cookieartbot/yyyi/record",{params:{limit:this.limit,skip:(this.page-1)*this.limit}}),this.get("/cookieartbot/yyyi/dicts")],e=await Promise.all(t);this.text_list=e[0].data.data,this.data=this.text_select in this.text_list?this.text_list[this.text_select]:{text:[]},this.text_count=e[0].data.count,this.dicts=e[1].data.data,this.loaded=!0},speaker_replace(t){return this.all_entries[t]?this.all_entries[t]:""},async update(){let t=await this.put(`/cookieartbot/yyyi/record/${this.data._id}`,{data:this.data});200==t.status?(this.diff_num=0,this.data.last_modified=t.data.last_modified):this.$q.notify({message:"保存失败，请检查",color:"negative",position:"top"})},now_timestamp(){return Math.round(Date.now())},text_add_click(){this.$refs.file.click()},save_conf(){let t=[];for(let a of this.data.text)"roasted_text"in a&&t.push({speaker:a.speaker,text:a.roasted_text});let e=new Blob([JSON.stringify(t)],{type:"application/json;charset=utf-8"});Object(r["saveAs"])(e,`${this.data.title}.json`)}},computed:{all_entries(){let t={};for(let e of this.dicts)t=n()(n()({},t),e.entries);return t}},async created(){await this.reset()}},c=l,d=(a("a9eb"),a("2877")),p=a("4d5a"),u=a("e359"),m=a("65c6"),f=a("6ac5"),h=a("9c40"),_=a("d847"),x=a("42a1"),k=a("27f9"),b=a("9404"),g=a("1c1c"),y=a("2c91"),v=a("66e5"),q=a("4074"),w=a("3b16"),$=a("74f7"),C=a("a154"),Q=a("eb85"),S=a("3b73"),T=a("09e3"),j=a("9989"),z=a("f09f"),P=a("a370"),B=a("8572"),M=a("b047"),E=a("cb32"),I=a("de5e"),H=a("714f"),J=a("eebe"),L=a.n(J),N=Object(d["a"])(c,s,i,!1,null,null,null);e["default"]=N.exports;L()(N,"components",{QLayout:p["a"],QHeader:u["a"],QToolbar:m["a"],QToolbarTitle:f["a"],QBtn:h["a"],QBar:_["a"],QPopupEdit:x["a"],QInput:k["a"],QDrawer:b["a"],QList:g["a"],QSpace:y["a"],QItem:v["a"],QItemSection:q["a"],QPagination:w["a"],QInnerLoading:$["a"],QSpinnerBars:C["a"],QSeparator:Q["a"],QExpansionItem:S["a"],QPageContainer:T["a"],QPage:j["a"],QCard:z["a"],QCardSection:P["a"],QField:B["a"],QChip:M["a"],QAvatar:E["a"],QPageSticky:I["a"]}),L()(N,"directives",{Ripple:H["a"]})},a9eb:function(t,e,a){"use strict";a("e0f7")},e0f7:function(t,e,a){}}]);